<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
      <link rel="STYLESHEET" href="https://www.spec.org/cpu2017/Docs/css/cpudocs.css" type="text/css" />
<title>502.gcc_r: SPEC CPU2017 Benchmark Description</title>
<meta name="generator" content="Cloyce+VIM 7.2" />
<meta name="revision"
      content="$Id: gcc.html 5751 2017-05-24 19:49:39Z JohnHenning $" />
</head>

<body>
<div style="text-align: center">
<h1>502.gcc_r<br />
SPEC CPU2017 Benchmark Description</h1>
</div>
 
<h3>Benchmark Name</h3>
<p>502.gcc_r</p>

<h3>Benchmark Author</h3>
<p>Richard Stallman and a large cast of helpers.<br />
   For a full list, see <a href="http://gcc.gnu.org/onlinedocs/gcc/Contributors.html">http://gcc.gnu.org/onlinedocs/gcc/Contributors.html</a></p>

<h3>Benchmark Program General Category</h3>
<p>C Language optimizing compiler</p>
 
<h3>Benchmark Description</h3>
<p>502.gcc_r is based on GCC Version 4.5.0.  It generates code for an IA32
   processor. The benchmark runs as a compiler with many of its optimization
   flags enabled.</p>

<p>502.gcc_r has altered inlining heuristics, so as to inline
   more code than may be typical of Unix systems as of the time that the
   porting work was done for the benchmark. This was done so that 502.gcc_r
   would spend more time analyzing its source code inputs, and use more
   memory. Without this effect, 502.gcc_r would have done less analysis, and
   needed more input workloads to achieve the run times required for CPU2017.  
   Recall that SPEC CPU benchmarks are drawn from 'the compute-intensive 
   portion of real applications'; therefore, for the benchmark version, the 
   preference is to compile a few large files instead of many small files.</p>


<h3>Input Description</h3>
<p>The inputs to the benchmark are C source code files.  The large files for 
   the ref workloads are GCC itself, after preprocessing.  The presentation of 
   the entire (preprocessed) source set at one time avoids I/O and allows 
   the benchmark compiler a wide scope as it considers optimizations.  There are
   several optimizations used, which can be found in the file <tt>control</tt> in 
   each of the input directories.  For example, the brief 'test' workload uses<br />
   <tt>-O3 -finline-limit=50000</tt>.  </p>

<p>New inputs can be generated by writing C source code.</p>


<h3>Output Description</h3>
<p>All output files are IA32 assembly code files.</p>


<h3>Programming Language</h3>
<p>C</p>

<h3>GNU C Portability Considerations: confusion from duplicate symbols
   <span id="Duplicate-symbols"> </span>   <span id="Portability"> </span>      <span id="Inline"> </span>
   <span id="Duplicate.symbols"> </span>   <span id="portability"> </span>      <span id="inline"> </span>
   <span id="DuplicateSymbols"> </span>    <span id="Porting"> </span>          <span id="Inlining"> </span>
   <span id="Duplicate_symbols"> </span>   <span id="porting"> </span>          <span id="inlining"> </span>
   <span id="Duplicatesymbols"> </span>
   <span id="duplicate-symbols"> </span>
   <span id="duplicate.symbols"> </span>
   <span id="duplicateSymbols"> </span>
   <span id="duplicate_symbols"> </span>
   <span id="duplicatesymbols"> </span>
</h3>

<p>You may encounter errors such as the following when compiling the SPEC CPU2017 benchmark version of gcc.  Read this
section if you see symbol definitions errors such as:</p>
<pre>
   cc1-checksum.o: In function `vprintf':
   /usr/include/bits/stdio.h:38: multiple definition of `vprintf'
   main.o:/usr/include/bits/stdio.h:38: first defined here
</pre>
<p>Notice in the message above that the compiler appears to be objecting to using a definition at 
<br /><tt>stdio.h:38</tt> because it already has a definition at 
<br /><tt>stdio.h:38</tt>.  </p>

<p>That somewhat confusing error signature is due to inclusion of header files
that use pre-1999 inlining keywords.  See the documentation of
<tt>-fgnu89-inline</tt> in the GNU chapter on <a
href="https://gcc.gnu.org/onlinedocs/gcc/C-Dialect-Options.html#index-fgnu89-inline-113">C-Dialect-Options</a>,
and the <a
href="https://gcc.gnu.org/onlinedocs/gcc/Inline.html#Inline">associated
discussion</a> of inlining, which explains how the keywords <tt>inline</tt>,
<tt>static</tt>, and <tt>extern</tt> were standardized in a manner that differs
from their pre-1999 use by GCC.  </p>

<p>The following table provides recommendations if you encounter the above error.</p>

<table>
   <tr>
      <th class="MajorCent">Data<br />Model</th>
      <th class="MajorCent">Workaround</th>
      <th class="MajorCent">Comments</th>
   </tr>
   <tr>
      <td style="border-top:thin solid black;"><tt style="white-space:nowrap;">-m32</tt> or <tt style="white-space:nowrap;">-m64</tt></td>
      <td style="border:thin solid gray;vertical-align:middle;text-align:center;">
         <tt>-std=gnuNN</tt>
         <br />
         <span style="text-decoration:none;font-size:90%;">MAY CAUSE DIFFICULTY FOR OTHER BENCHMARKS</span>
      </td>
      <td style="border-top:thin solid black;"><p style="margin-top:1px;">If you select a language dialect that enables GNU
         extensions, you may find that 502.gcc_r succeeds but other benchmarks fail.  </p>

         <p style="margin-bottom:1px;">Recall that SPEC's rules require that in 'base', all modules of a given language 
         must use <a href="https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags">the&nbsp;same&nbsp;flags</a>.
         You should pick a language dialect that works for all the benchmarks in the suite.  (Note: using <tt>std=gnuXX</tt>
         as a "Portability" flag is not likely to be approved by SPEC, because <a
            href="https://www.spec.org/cpu2017/Docs/runrules.html#portability">the&nbsp;portabilty&nbsp;rule</a>
         considers degree of impact.  Setting a GNU-specific dialect as a portablility flag is not required given that more
         narrow solutions are available.)</p></td>
   </tr>

   <tr>
      <td style="border-top:thin solid black;"><tt>-m64</tt></td>
      <td style="border:thin solid gray;vertical-align:middle;background:#d0ffd0"> 
         <pre style="margin-left:1em;">intrate,intspeed=base:
LDCFLAGS = -z muldefs</pre>
         <div style="text-align:center;text-decoration:none;font-size:90%;">RECOMMENDED</div>
      </td>
      <td style="border-top:thin solid black;"><p style="margin-top:1px;">If compiling 64-bit, the recommendation is to allow
         multiple definitions. The linker uses the first definition that it sees,  which is benign, because (for example) the
         routine at <br /><tt>stdio.h:38</tt> happens to be identical to the routine at 
         <br /><tt>stdio.h:38</tt>.  </p>
         <p style="margin-bottom:1px;">Note: as shown on the left, in base you would set the flag for all benchmarks.  In
         peak, if you wish, you could be more selective and set it only for 502.gcc_r.</p>
      </td>
   </tr>  

   <tr>
      <td style="border-top:thin solid black;"><tt>-m32</tt></td>
      <td style="border:thin solid gray;vertical-align:middle;text-align:center;">
         <tt>-z muldefs -D_FILE_OFFSET_BITS=64</tt>
         <br />
         <span style="text-decoration:none;font-size:90%;">WORTH TRYING</span>
      </td>
      <td style="border-top:thin solid black;"><p style="margin:0em 2px;">If you
         are compiling 32-bit, you can try <tt style="white-space:nowrap;">-z
            muldefs -D_FILE_OFFSET_BITS=64</tt>.  Perhaps it will work.  Or, it may
         fail with messages from the GNU assembler as described below. </p> </td>
   </tr>

   <tr>
      <td style="border-top:thin solid black;"><tt>-m32</tt></td>
      <td style="border:thin solid gray;vertical-align:middle;text-align:center;">
         <tt>-z muldefs</tt> 
         <br />
         <span style="white-space:nowrap;">(without mention of <tt>_FILE_OFFSET_BITS</tt>)</span>
         <br />
         <span style="text-decoration:none;font-size:90%;">NOT RECOMMENDED</span>
      </td>
      <td style="border-top:thin solid black;"><p style="margin:0em 2px;"> It is
         strongly recommended that 32-bit compiles should include
         <tt>-D_FILE_OFFSET_BITS=64</tt>, because at run-time, operations using
         modern file systems may fail spectacularly and frequently (or, worse,
         quietly and randomly) if a program does not accommodate 64-bit
         metadata.</p></td>
   </tr>

   <tr>
      <td style="border-top:thin solid black;border-bottom:thin solid black;"><tt>-m32</tt></td>
      <td style="border:thin solid gray;vertical-align:middle;background:#d0ffd0"> 
         <pre style="margin:0.5em;">intrate,intspeed=base:
PORTABILITY     = -D_FILE_OFFSET_BITS=64
EXTRA_COPTIMIZE = -fgnu89-inline</pre>
         <div style="text-decoration:none;text-align:center;font-size:90%;">RECOMMENDED</div>
      </td>
      <td style="border-top:thin solid black;border-bottom:thin solid black">
         <p style="margin-bottom:.2em;margin-top:0em;">As described just above, 32-bit compiles should include
         <tt>-D_FILE_OFFSET_BITS=64</tt> in order to ensure that they run correctly on modern file systems.  You may find
         that doing so leads to symptoms such as:</p>
         <pre style="margin:.2em;">   filename: Assembler messages:
   filename:11843: Error: symbol `stat64' is already defined
   filename:11863: Error: symbol `lstat64' is already defined </pre>

         <p style="margin-top:0.2em;">The above error occurs on certain paths through system header files
         that lead to GCC deciding that the code body needs to be included in the assembly routine <span
            style="white-space:nowrap;">-- twice</span>.  If this happens in your environment, a solution is <tt
            style="white-space:nowrap;">-fgnu89-inline</tt>.</p>

         <p style="margin-bottom:1px;">Note: as shown on the left, in base you would set the flag for all benchmarks.  In
         peak, if you wish, you could be more selective and set it only for 502.gcc_r.</p>
      </td>

   </tr>
</table>

<h3>Other Portability Considerations</h3>

<ol>
   <li>Some of the optimizations 502.gcc_r performs require constant
   propagation of floating point constants. These form an insignificant
   amount of computation time, yet may depend on IEEE floating point
   format to produce a correct result.</li>
   <li>502.gcc_r is not an ANSI C program. It uses GNU extensions.</li>
   <li>The initial port of 502.gcc_r was to a 64 bit system. It has been
   successfully ported by SPEC to many 32-bit UNIX implementations.</li>
</ol>


<h3 id="license">Sources and Licensing</h3>

<p>502.gcc_r is based on the GNU C compiler version 4.5, using the GNU GPL license.  </p>

  <p>Please see details in the document <a
    href="https://www.spec.org/cpu2017/Docs/licenses.html#bmk502.gcc_r">SPEC CPU2017 Licenses</a>.</p>


<h3>References</h3>
<ul>
   <li>See the <a href="http://gcc.gnu.org">GCC home page</a></li>
</ul>

<p>Last updated: $Date: 2017-05-24 15:49:39 -0400 (Wed, 24 May 2017) $</p>
</body>
</html>
